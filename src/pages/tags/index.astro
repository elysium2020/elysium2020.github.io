---
import Layout from '@/layouts/Layout.astro';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Tag } from 'lucide-react';
import { allPosts, allTags as tags } from '@/lib/content';
import Searcher from '@/components/Searcher.tsx';

const tagCountMap = Object.fromEntries(
  tags.map((tag) => [
    tag,
    allPosts.filter((post) => post.data.tags.includes(tag)).length,
  ]),
);
---

<Layout pageTitle="所有标签">
  <main class="container mx-auto max-w-5xl p-8">
    <section class="mb-12 space-y-4 text-center">
      <h1 class="text-4xl font-extrabold tracking-tight lg:text-5xl">
        所有标签
      </h1>
      <p class="text-muted-foreground text-xl">
        共 {tags.length} 个标签
      </p>
    </section>

    <Searcher
      client:visible
      placeholder="搜索标签..."
      gridSelector="#tags-grid"
      cardSelector=".tag-card"
      dataAttributes={['tag']}
    />

    <section
      id="tags-grid"
      class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5">
      {
        tags.map((tag: string) => {
          const postCount = tagCountMap[tag];

          return (
            <Card
              key={tag}
              data-tag={tag}
              client:visible
              className="tag-card group relative overflow-hidden rounded-xl transition-all duration-300 hover:shadow-lg hover:border-primary/30">
              <a
                href={`/tags/${tag}`}
                class="ring-primary absolute inset-0 rounded-xl transition-all focus-visible:ring-2"
                aria-label={`查看 ${tag} 标签文章`}
              />

              <CardHeader className="pb-2 pt-5">
                <div class="flex flex-col items-center gap-2">
                  <Tag className="h-6 w-6 text-muted-foreground transition-all duration-300 group-hover:text-primary group-hover:-translate-y-0.5" />
                  <CardTitle className="text-xl text-center font-semibold tracking-tight transition-colors group-hover:text-primary">
                    {tag}
                  </CardTitle>
                </div>
              </CardHeader>

              <CardContent className="flex justify-center pb-5">
                <Badge
                  variant="secondary"
                  className="px-2 py-0.5 text-xs font-medium">
                  {postCount} 篇文章
                </Badge>
              </CardContent>
            </Card>
          );
        })
      }
    </section>
  </main>
</Layout>
